---
title: "The price of strawberries at different suppliers in Canada"
subtitle: "My subtitle if needed"
author: 
  - Tianning He
thanks: "Code and data are available at: https://github.com/HeTianning/The-price-of-strawberries"
date: 25 November 2024
date-format: long
abstract: "This study investigates the pricing of strawberries across eight major suppliers in Canada: Voila, T&T, Loblaws, No Frills, Metro, Galleria, Walmart, and Save-On-Foods. Using simulated and analyzed data, a Bayesian regression model was applied to compare strawberry prices while accounting for factors such as organic labeling and sale status. Results indicate significant price variation among suppliers, with some consistently charging premiums for organic options and sale effects moderating pricing. These findings provide insights into supplier-specific pricing strategies, offering consumers and policymakers a clearer understanding of the Canadian strawberry market."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(tinytex)
library(knitr)
library(ggplot2)
library(dplyr)
library(arrow)
library(here)
library(modelsummary)
```


# Introduction

The pricing of strawberries varies significantly across suppliers in Canada, reflecting differences in supply chains, market positioning, and consumer demand. This study focuses on eight prominent Canadian suppliers—Voila, T&T, Loblaws, No Frills, Metro, Galleria, Walmart, and Save-On-Foods—to investigate patterns in strawberry pricing. By analyzing factors such as vendor, organic labeling, and sale status, the study identifies key trends in pricing strategies. The insights aim to provide a comprehensive understanding of how strawberries are priced across the country and what drives these differences.
The central goal of this analysis is to estimate and compare the average prices of strawberries across the eight suppliers while controlling for organic status and sales promotions. A Bayesian regression model was employed to quantify the relationship between vendor-specific pricing and these factors. The model allows for a robust analysis of vendor effects on price variation, providing insights into how each supplier’s pricing compares to others. This estimand offers clarity on the roles of supplier identity, product characteristics, and promotional activities in shaping strawberry prices.
The findings reveal substantial price differences among the eight suppliers, with premium-priced vendors standing out for organic strawberries and lower-priced options benefiting from frequent promotional sales. Suppliers like Galleria and T&T demonstrated higher average prices, often linked to niche or premium positioning, while Walmart and No Frills consistently offered the most competitive prices. Organic labeling emerged as a strong driver of price increases, while sale status often reduced prices by a substantial margin across all suppliers. These results underline the importance of vendor-specific strategies and product attributes in determining consumer costs.
Understanding the pricing structure of strawberries in Canada is crucial for both consumers and policymakers aiming to ensure fair market practices and affordable food access. For consumers, this study highlights where to find competitively priced strawberries and the factors influencing these prices. For policymakers, the insights can inform strategies to regulate pricing disparities and support equitable food distribution. This analysis contributes to a broader discussion on how supplier practices shape food affordability and accessibility, with implications for future agricultural and retail policies in Canada.

Telegraphing paragraph: The remainder of this paper is structured as follows. @sec-data....






# Data {#sec-data}
To simulate, test, download, clean, and model data throughout this analysis, the statistical programming language R was used [@citeR]. Specific libraries that assisted the analysis include `tidyverse` [@tidyverse], `tinytex` [@tinytex], `ggplot2` [@ggplot2], `knitr` [@knitr], `arrow` [@arrow], `here` [@here], `testthat` [@testthat], and `modelsummary` [@modelsummary]. 
## Overview

We use the statistical programming language R [@citeR].... Our data [@shelter].... Following @tellingstories, we consider...

The data for this analysis was provided by Project Hammer [@data], which was collected through a process of scraping website UI screens from vendors within the Toronto community. It contains data on product details (e.g., product name, brand, current and old price, and unit of product) for 8 different grocery stores (Voila, T&T, Loblaws, No Frills, Metro, Galleria, Walmart Canada, and Save-On-Foods). Project Hammer's data is available from February 28, 2024, and since the data is collected by extracting information from grocery store websites, there may be missing data, as discussed in @sec-discussion. Through the method of screen scraping, the raw data is intended to measure and reflect grocery store vendor decisions and product pricing trends.
For this analysis, the eight vendors - Voila, T&T, Loblaws, No Frills, Metro, Galleria, Walmart Canada, and Save-On-Foods - and their pricing for strawberries were considered. The variable “price” for each supplier in this analysis reflects the current price of their product at the time the data was downloaded.

## Measurement
	
The data captures strawberry pricing through a structured set of variables, ensuring a comprehensive analysis of supplier-based differences. The primary variable of interest, price_per_lb, is a continuous measure representing the price of strawberries per pound in Canadian dollars. This variable reflects vendor-specific pricing strategies and serves as the dependent variable in the analysis.

Additional explanatory variables include vendor, a categorical variable indicating one of eight suppliers (Voila, T&T, Loblaws, No Frills, Metro, Galleria, Walmart, and Save-On-Foods), and organic, a binary variable where "Yes" denotes organic strawberries and "No" represents non-organic ones. The sale variable is also binary, capturing whether the strawberries were on sale ("On Sale") or not ("Not on Sale").

Finally, date is a temporal variable that records the observation date, enabling the study of potential seasonal trends or temporal price fluctuations. Together, these measurements allow for a detailed assessment of how strawberry prices are influenced by vendor identity, product attributes, and sales promotions, providing both granular and aggregate insights into the Canadian strawberry market.

```{r}
#| echo: false
#| message: false
#| label: tbl-rawdata
#| tbl-cap: "Paramedic Services Incident Data for 2022" 

data <- read_csv(here::here("data/01-raw_data/raw_data.csv"))

# Filter for strawberry-related products
strawberry_data <- data %>%
  filter(str_detect(product_name, regex("strawberry", ignore_case = TRUE))) %>%
  select(vendor, product_name, price_per_lb, organic, sale, units, date)

# Display a sample of the strawberry data
strawberry_data %>%
  slice(1:5) %>%  # Display the first 5 rows for simplicity
  kable(
    col.names = c("Vendor", "Product Name", "Price Per Pound", "Organic", 
                  "Sale", "Units", "Date"),
    digits = 2,
    booktabs = TRUE,
    linesep = "",
    align = c("l", "l", "r", "l", "l", "l", "l"),
    format.args = list(big.mark = ","),
    caption = "Sample Strawberry Data"
  )

```

## Outcome variables

The primary outcome variable in this study is price_per_lb, which represents the price of strawberries per pound, measured in Canadian dollars. This continuous variable serves as the dependent variable in the analysis and reflects the central focus of the study: understanding and comparing strawberry prices across different suppliers.

The variability in price_per_lb is analyzed concerning the following factors:

Vendor (vendor): A categorical variable indicating the supplier, which is expected to influence pricing strategies.
Organic Status (organic): A binary variable ("Yes" or "No") indicating whether the strawberries are organic, which typically commands a premium price.
Sale Status (sale): A binary variable ("On Sale" or "Not on Sale") capturing promotional discounts, often associated with lower prices.
By modeling the outcome variable, the study investigates how these factors interact to explain price differences among suppliers. The insights derived from this analysis highlight the dynamics of strawberry pricing in Canada’s retail market.



Some of our data is of penguins (@fig-bills), from @palmerpenguins.

```{r}
#| label: fig-pricedistribution
#| fig-cap: Distribution of Prices
#| echo: false

ggplot(strawberry_data, aes(x = price_per_lb)) +
  geom_histogram(binwidth = 0.2, fill = "skyblue", color = "black") +
  labs(
    x = "Price Per Pound (CAD)",
    y = "Frequency"
  ) +
  theme_minimal()
```

Talk more about it.

And also planes (@fig-planes). (You can change the height and width, but don't worry about doing that until you have finished every other aspect of the paper - Quarto will try to make it look nice and the defaults usually work well once you have enough text.)

```{r}
#| label: fig-vendor
#| fig-cap: Price Distribution by Vendor
#| echo: false
#| warning: false
#| message: false

analysis_data <- read_csv(here::here("data/02-analysis_data/analysis_data.csv"))

analysis_data |> 
  ggplot(strawberry_data, aes(x = vendor, y = price_per_lb, fill = vendor)) +
  geom_boxplot() +
  labs(
    x = "Vendor",
    y = "Price Per Pound (CAD)"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

Talk way more about it. 
```{r}
#| label: fig-organic
#| fig-cap: Price Comparison: Organic vs Non-Organic
#| echo: false
#| warning: false
#| message: false

analysis_data <- read_csv(here::here("data/02-analysis_data/analysis_data.csv"))

analysis_data |> 
  ggplot(strawberry_data, aes(x = organic, y = price_per_lb, fill = organic)) +
  geom_boxplot() +
  labs(
    x = "Organic Status",
    y = "Price Per Pound (CAD)"
  ) +
  theme_minimal()

```

```{r}
#| label: fig-sale
#| fig-cap: Effect of Sale on Strawberry Prices
#| echo: false
#| warning: false
#| message: false

analysis_data <- read_csv(here::here("data/02-analysis_data/analysis_data.csv"))

analysis_data |> 
  ggplot(strawberry_data, aes(x = sale, y = price_per_lb, fill = sale)) +
  geom_boxplot() +
  labs(
    x = "Sale Status",
    y = "Price Per Pound (CAD)"
  ) +
  theme_minimal()

```

```{r}
#| label: fig-date
#| fig-cap: Strawberry Prices Over Time
#| echo: false
#| warning: false
#| message: false

price_trend <- strawberry_data %>%
  group_by(date) %>%
  summarise(avg_price = mean(price_per_lb, na.rm = TRUE))

analysis_data <- read_csv(here::here("data/02-analysis_data/analysis_data.csv"))

analysis_data |> 
  ggplot(price_trend, aes(x = date, y = avg_price)) +
  geom_line(color = "blue") +
  geom_point(color = "red") +
  labs(
    title = "Strawberry Prices Over Time",
    x = "Date",
    y = "Average Price (CAD)"
  ) +
  theme_minimal()

```


## Predictor variables

Predictor Variables: Exploring Factors Influencing Strawberry Prices
1. Vendor (vendor)
The vendor variable is categorical, representing the supplier of strawberries. Different vendors employ varying pricing strategies, which are reflected in the distribution of price_per_lb. Vendors such as Galleria and T&T may target premium markets, resulting in higher median prices, while Walmart and No Frills tend to offer lower prices. The table summarizes average prices for each vendor, and the boxplot illustrates the variability in pricing.

2. Organic Status (organic)
The organic variable is binary, indicating whether the strawberries are labeled as organic (Yes) or not (No). Organic strawberries typically command higher prices due to perceived quality and health benefits. The table summarizes average prices for organic and non-organic strawberries, and the boxplot highlights the significant price differences between these two categories.

3. Sale Status (sale)
The sale variable indicates whether the strawberries were on sale (On Sale) or not (Not on Sale). Promotions are a major driver of price reductions, and strawberries on sale consistently exhibit lower prices compared to regular-priced items. The table shows average prices by sale status, and the boxplot visually demonstrates the effect of sales on pricing.

4. Time (date)
The date variable is temporal, capturing the observation date for each price entry. Seasonal trends and time-based fluctuations are common in fresh produce pricing, including strawberries. By analyzing prices over time, we observe peaks and dips that may align with seasonal demand (e.g., summer months) or supply disruptions. The line chart below shows average prices across all vendors over time, while individual trends for each vendor reveal how pricing strategies change seasonally.

5. Combined Analysis: Vendor, Organic, Sale, and Time
To explore the combined effects of time, vendors, organic labeling, and sale status on prices, the bar chart below shows average prices segmented by vendor, organic status, and sale status across time intervals. This analysis highlights the interplay of these factors in shaping pricing strategies.

```{r}
#| label: fig-combined
#| fig-cap: Price Trends by Vendor Over Time
#| echo: false
#| warning: false
#| message: false

analysis_data <- read_csv(here::here("data/02-analysis_data/analysis_data.csv"))

analysis_data |> 
  ggplot(strawberry_data, aes(x = date, y = price_per_lb, color = vendor)) +
  geom_line() +
  labs(
    x = "Date",
    y = "Price Per Pound (CAD)",
    color = "Vendor"
  ) +
  theme_minimal()

```






# Model

## Purpose of the Model

The purpose of this model is to identify and quantify the factors that influence the price per pound of strawberries from different suppliers in Canada. The analysis evaluates how key predictors, such as supplier, organic label, sale status, and time, affect pricing. Specifically, the model aims to:

- Quantify the impact of each predictor (e.g., supplier, organic status, sale status, and time) on strawberry prices.
- Compare pricing strategies across suppliers.
- Analyze seasonal trends in strawberry prices and identify periods of high or low prices.
- Provide actionable insights into pricing strategies and market dynamics.
## Model Description

The model chosen for this analysis is a **Bayesian linear regression model**. It builds upon the simplicity and interpretability of traditional linear regression but incorporates the Bayesian framework to provide more robust and probabilistic insights. 

The predictors in the model include:
- **Vendor (`vendor`)**: A categorical variable representing the supplier.
- **Organic Status (`organic`)**: A binary variable indicating whether the strawberries are organic.
- **Sale Status (`sale`)**: A binary variable indicating whether the strawberries are on sale.
- **Date (`date`)**: A time variable capturing potential seasonal or time-related trends.



## Model set-up

The Bayesian linear regression model is expressed as:

\[
y_i = \beta_0 + \beta_{vendor[i]} + \beta_{organic} \cdot x_{organic[i]} + \beta_{sale} \cdot x_{sale[i]} + \beta_{date} \cdot x_{date[i]} + \epsilon_i
\]

**Where**:
- \( y_i \): Price per pound of strawberries for observation \( i \) (dependent variable).
- \( \beta_0 \): Intercept, representing the baseline price (reference vendor, non-organic, not on sale, and earliest date).
- \( \beta_{vendor[i]} \): Vendor-specific effect, indicating how each supplier’s prices deviate from the baseline vendor.
- \( \beta_{organic} \): Effect of organic labeling, representing the price premium for organic strawberries.
- \( \beta_{sale} \): Effect of sale status, representing the price discount due to promotions.
- \( \beta_{date} \): Effect of time, capturing trends in strawberry pricing.
- \( \epsilon_i \): Residual error, accounting for variability not explained by the predictors.
## Priors in the Bayesian Framework

In the Bayesian framework, priors are specified for each parameter:

- **Coefficients (\( \beta \))**:
  \[
  \beta \sim \text{Normal}(0, 2.5)
  \]
  - This reflects the belief that most effects are small and centered around zero, with moderate variability.

- **Residual Standard Deviation (\( \sigma \))**:
  \[
  \sigma \sim \text{Exponential}(1)
  \]
  - This ensures positivity and reflects typical variance patterns in continuous data.



We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.


### Model justification

#### Why Use a Bayesian Linear Regression Model?
A Bayesian linear regression model is an effective approach for this analysis because it balances simplicity, interpretability, and flexibility. It is particularly suited for modeling a continuous dependent variable, such as the price of strawberry, while allowing the incorporation of prior knowledge and the quantification of uncertainty in parameter estimates. This model provides a robust framework to understand how vendor, organic status, sale status, and time influence strawberry prices.

Traditional linear regression assumes a deterministic relationship between predictors and the outcome, providing point estimates for coefficients. However, the Bayesian approach enriches this by generating posterior distributions for all model parameters. These distributions capture the uncertainty inherent in the data, providing a clearer and more nuanced understanding of the predictors' effects.
#### Benefits of Using Bayesian Regression

1. **Uncertainty Quantification**:
   - The Bayesian approach provides posterior distributions for parameters rather than single-point estimates. For example, the posterior distribution of \( \beta_{\text{organic}} \) allows us to quantify the uncertainty around the organic price premium.

2. **Incorporating Prior Knowledge**:
   - Priors enable the incorporation of domain knowledge into the model. For instance:
     - The prior for \( \beta_{\text{organic}} \) reflects the expectation of a positive premium for organic strawberries.
     - The prior for \( \beta_{\text{sale}} \) reflects the expectation that sales typically reduce prices.

3. **Flexibility with Sparse Data**:
   - Bayesian models stabilize parameter estimates when some predictors, such as certain vendors, have fewer observations. The priors act as a regularizing factor in such cases.

4. **Probabilistic Insights**:
   - Posterior distributions provide credible intervals, which are more intuitive than frequentist confidence intervals. For example, a 95% credible interval for \( \beta_{\text{organic}} \) of \([0.5, 1.5]\) means there is a 95% probability that the organic premium lies within this range.

#### Expected Results

1. **Vendor-Specific Strategies**:
   - The model will estimate vendor-specific coefficients (\( \beta_{\text{vendor}} \)) to reveal pricing differences among suppliers.
   - For example, some vendors may consistently charge higher prices due to branding or location.

2. **Organic Premium**:
   - The coefficient \( \beta_{\text{organic}} \) is expected to be positive, quantifying the price premium for organic strawberries.

3. **Effect of Sales**:
   - The coefficient \( \beta_{\text{sale}} \) is expected to be negative, reflecting price reductions during sales promotions.

4. **Temporal Trends**:
   - The coefficient \( \beta_{\text{date}} \) will capture seasonal or long-term trends in strawberry pricing, identifying high-demand periods or price fluctuations.


The Bayesian linear regression model provides a robust framework for understanding strawberry pricing dynamics in the Canadian market. By including predictors such as vendor, organic status, sale status, and date, the model captures both individual and combined effects on pricing. Its ability to quantify uncertainty, incorporate prior knowledge, and analyze temporal trends makes it a valuable tool for uncovering actionable insights in strawberry pricing strategies and market dynamics.


# Results

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(rstanarm)

first_model <-
  readRDS(file = here::here("models/first_model.rds"))
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false

modelsummary::modelsummary(
  list(
    "First model" = first_model
  ),
  statistic = "mad",
  fmt = 2
)
```




# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Limitations of the Bayesian Linear Regression Model

The Bayesian linear regression model provides a robust framework for analyzing strawberry pricing, but it comes with limitations that should be acknowledged. One key assumption is linearity, which may not capture non-linear or cyclical patterns in the data, such as seasonal trends or interactions between predictors like vendor and sale status. While interaction terms or polynomial extensions can address this, more flexible models such as generalized additive models (GAMs) may be better suited for highly non-linear relationships.

The model’s reliance on priors is both a strength and a challenge. Informative priors can stabilize estimates, particularly in cases of sparse data, but overly strong or poorly chosen priors can bias results. Sensitivity analysis and careful prior selection, ideally informed by domain knowledge, are essential to mitigate this risk. Furthermore, Bayesian methods are computationally demanding compared to traditional linear regression, particularly with large datasets or complex models. Approximation techniques like variational inference can alleviate computational strain, but they may compromise accuracy.

Data quality also significantly impacts the model's reliability. Missing, sparse, or erroneous data can lead to biased estimates, particularly for categorical variables like vendor or binary predictors like sale status. Effective preprocessing and regularization through priors are necessary to handle these issues. Additionally, while posterior distributions provide nuanced probabilistic insights, their interpretation can be challenging for non-experts. Visualizations and clear communication are critical to ensure that stakeholders correctly understand the results.

Finally, the model assumes residuals are independent and identically distributed (IID) and normally distributed, which may not hold for temporal data prone to autocorrelation or heteroscedasticity. Robust adjustments or time-series-specific Bayesian models can address these issues. The model also struggles with scalability as complexity increases and is poorly suited for extrapolation beyond observed data. Recognizing these limitations and employing strategies like simplifying the model, monitoring diagnostics, or focusing on interpolation within observed ranges ensures more reliable and actionable insights.

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

pp_check(first_model) +
  theme_classic() +
  theme(legend.position = "bottom")

posterior_vs_prior(first_model) +
  theme_minimal() +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom") +
  coord_flip()
```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

plot(first_model, "trace")

plot(first_model, "rhat")
```



\newpage


# References


